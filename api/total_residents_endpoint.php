<?php
require_once '../config.php'; // Adjust the path as needed
require_once '../vendor/autoload.php';
require_once '../models/survey.php';

$surveyModel = new Survey($conn);
// Define a cache file path
$cacheFile = '../cache/surveyData.json';
$cacheTime = 600; // Cache for 1 hour

// Function to fetch and cache survey data
function fetchAndCacheSurveyData($surveyModel, $cacheFile) {
    // Fetch data from the database
    $data = [
        'totalResidents' => $surveyModel->countSurveys(),
        'totalMales' => $surveyModel->getTotalMales(),
        'totalFemales' => $surveyModel->getTotalFemales(),
        'totalSeniors' => $surveyModel->getTotalSeniors(),
    ];
    // Cache the data in JSON format
    file_put_contents($cacheFile, json_encode($data));
    return $data;
}

// Check if the cache file exists and is still valid
if (file_exists($cacheFile) && (time() - filemtime($cacheFile) < $cacheTime)) {
    // Cache file is valid, read the data from the cache
    $cachedData = json_decode(file_get_contents($cacheFile), true);
} else {
    // Cache is invalid or doesn't exist, fetch and cache the data
    $cachedData = fetchAndCacheSurveyData($surveyModel, $cacheFile);
}

// Extract the data
$totalResidents = $cachedData['totalResidents'];
$totalMales = $cachedData['totalMales'];
$totalFemales = $cachedData['totalFemales'];
$totalSeniors = $cachedData['totalSeniors'];
// This is the content that will replace the widget
?>
<div
    class="col-span-2 p-4 bg-white border border-gray-200 rounded-lg shadow-md lg:col-span-1 dark:border-gray-700 sm:p-6 dark:bg-gray-800">
    <div class="relative">
        <svg class="absolute text-blue-500 h-14 w-14 bottom-4 right-3" viewBox="0 -12 1048 1048" fill="currentColor"
            class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg">

            <path
                d="M334.571747 570.128513a14.452891 14.452891 0 0 0 14.452891 14.70645h125.638727c7.987124 0 14.452891-6.592547 14.452891-14.83323V528.671536c0-8.240683-6.338987-14.83323-14.452891-14.83323h-125.638727c-7.987124 0-14.452891 6.592547-14.452891 14.706451v41.583756zM474.663365 233.78185c7.987124 0 14.452891-6.592547 14.452891-14.83323V177.491643c0-8.240683-6.338987-14.83323-14.452891-14.83323h-125.638727c-7.987124 0-14.452891 6.592547-14.452891 14.70645v41.456977a14.452891 14.452891 0 0 0 14.452891 14.70645h125.638727zM464.013867 985.966077c0-22.440015 2.535595-44.372911 6.972886-65.798688h-107.382444v-100.155999h-112.453634v100.155999H87.731584c-9.381701 0-16.734926-7.480005-16.734927-16.861706V87.985143c0-4.437291 1.648137-8.874582 4.81763-12.044076s7.480005-4.94441 11.917297-4.94441h439.291816c4.437291 0 8.747802 1.774916 11.917296 4.94441s4.94441 7.606785 4.81763 11.917296v347.376501a101.246304 101.246304 0 0 1 68.080723-26.243407c1.014238 0 1.901696 0 2.915934 0.12678v-50.711898a16.89974 16.89974 0 0 1 16.734927-16.861706h272.069332c4.437291 0 8.747802 1.774916 11.790517 4.94441 3.169494 3.169494 4.94441 7.480005 4.94441 11.917296v49.063761c27.891544 17.749164 52.106475 40.696298 70.996657 67.827164V305.919525c0-19.524081-15.847468-35.371549-35.244769-35.371549H614.628204V35.498329A35.498329 35.498329 0 0 0 579.256655 0H35.371549A35.574396 35.574396 0 0 0 0 35.498329v920.167388a35.498329 35.498329 0 0 0 35.371549 35.498329h428.895877c-0.12678-1.774916-0.253559-3.549833-0.253559-5.197969zM334.571747 394.665346a14.452891 14.452891 0 0 0 14.452891 14.70645h125.638727c7.987124 0 14.452891-6.592547 14.452891-14.83323v-41.456976c0-8.240683-6.338987-14.83323-14.452891-14.83323h-125.638727c-7.987124 0-14.452891 6.592547-14.452891 14.70645v41.710536zM334.571747 745.71846c0 3.930172 1.521357 7.606785 4.183732 10.395939 2.662375 2.789154 6.465767 4.310511 10.269159 4.310511h125.638727c7.987124 0 14.452891-6.592547 14.452891-14.83323v-41.456977c0-8.240683-6.338987-14.83323-14.452891-14.83323h-125.638727c-7.987124 0-14.452891 6.592547-14.452891 14.706451v41.710536zM280.056457 353.208369c0-8.240683-6.338987-14.83323-14.452891-14.83323h-125.638728c-7.987124 0-14.452891 6.592547-14.45289 14.706451v41.456976c0 3.803392 1.521357 7.606785 4.183731 10.395939 2.662375 2.789154 6.465767 4.310511 10.269159 4.310512h125.638728c7.987124 0 14.452891-6.592547 14.452891-14.83323v-41.203418zM280.056457 528.671536c0-8.240683-6.338987-14.83323-14.452891-14.83323h-125.638728c-7.987124 0-14.452891 6.592547-14.45289 14.706451v41.456976c0 3.803392 1.521357 7.606785 4.183731 10.395939 2.662375 2.789154 6.465767 4.310511 10.269159 4.310512h125.638728c7.987124 0 14.452891-6.592547 14.452891-14.83323V528.671536zM280.056457 177.618423c0-8.240683-6.338987-14.83323-14.452891-14.83323h-125.638728c-7.987124 0-14.452891 6.592547-14.45289 14.83323v41.456976c0 3.803392 1.521357 7.606785 4.183731 10.395939 2.789154 2.789154 6.338987 4.310511 10.269159 4.310512h125.638728c7.987124 0 14.452891-6.592547 14.452891-14.83323v-41.330197zM139.964838 689.428253c-7.987124 0-14.452891 6.592547-14.45289 14.70645v41.456977c0 3.803392 1.521357 7.606785 4.183731 10.395939 2.662375 2.789154 6.465767 4.310511 10.269159 4.310511h125.638728c7.987124 0 14.452891-6.592547 14.452891-14.83323v-41.456976c0-8.240683-6.338987-14.83323-14.452891-14.83323h-125.638728zM787.682555 432.065371c-38.921382 0-75.180389 12.170856-104.973628 32.835954 0 0-0.12678 0-0.12678 0.126779-16.861706 10.522719-46.781726 8.621023-68.714622 7.353226-20.918658-1.141018-39.048161 14.70645-40.315959 35.625108a38.109991 38.109991 0 0 0 35.625109 40.315959l6.846106 0.380339c-8.367463 21.172217-13.185093 44.119351-13.185094 68.207503 0 55.402749 24.595271 104.973629 63.389873 138.9506-82.406834 43.612232-138.823821 130.329578-138.823821 230.105238 0 21.045438 16.988486 38.033923 38.033923 38.033923s38.033923-16.988486 38.033924-38.033923c0-101.550576 82.660394-184.210969 184.337749-184.21097 101.930915 0 184.718088-82.913953 184.718089-184.718088s-82.913953-184.971648-184.844869-184.971648z m0 293.495109c-59.966819 0-108.650241-48.810202-108.650241-108.650241s48.810202-108.650241 108.650241-108.650241 108.650241 48.810202 108.650242 108.650241-48.683422 108.650241-108.650242 108.650241zM987.867773 819.377492a38.148025 38.148025 0 0 0-53.627832-4.94441 38.148025 38.148025 0 0 0-4.94441 53.627832c27.511205 32.962734 42.597994 74.80005 42.597994 117.905163 0 21.045438 16.988486 38.033923 38.033923 38.033923s38.033923-16.988486 38.033924-38.033923c0.12678-60.854278-21.298997-119.933639-60.093599-166.588585z">
            </path>

        </svg>
        <div class="flex items-center justify-between ">
            <i class="text-xl text-gray-400 fab fa-behance"></i>
        </div>
        <div class="mt-5 text-2xl font-medium leading-8 text-gray-900 dark:text-gray-200">

            <?php echo $totalResidents; ?>
        </div>
        <div class="text-sm text-gray-700 dark:text-gray-500">Total Residents</div>
    </div>

</div>

<div
    class="col-span-2 p-4 bg-white border border-gray-200 rounded-lg shadow-md lg:col-span-1 dark:border-gray-700 sm:p-6 dark:bg-gray-800">
    <div class="relative ">
        <svg class="absolute text-blue-500 h-14 w-14 bottom-4 right-3" fill="currentColor" version="1.1" id="Capa_1"
            xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 440 440"
            xml:space="preserve">


            <path
                d="M398.781,400.842c-0.585-3.45-1.193-6.896-1.823-10.347c-7.226-39.39-19.038-102.017-64.124-135.877 c3.326-22.054,5.029-56.337,5.029-107.331C337.863,65.882,285.074,0,220,0c-44.375,0-72.592,31.445-72.592,31.445 c-27.487,27.001-45.271,68.793-45.271,116.003c0,50.848,1.779,85.142,5.019,107.114c-45.29,33.524-56.883,96.658-64.115,136.072 c-0.628,3.442-1.236,6.89-1.821,10.334c-3.093,18.202,9.156,35.461,27.355,38.554c1.896,0.322,3.777,0.478,5.638,0.478 l116.984-0.03l0.003-0.023l174.585-0.078c1.859,0,3.743-0.153,5.636-0.479C389.622,436.3,401.872,419.044,398.781,400.842z M220.034,324.404l-62.152-31.666l32.238-50.824c8.74,4.458,20.255,6.986,29.88,6.986c9.664,0,20.979-2.578,29.75-7.073 l32.157,50.924L220.034,324.404z M220,226.9c-59.158,0-84.628-80.045-79.546-105.039c65.035-56.563,122.614-52.656,122.614-52.656 s10.323,32.059,36.873,70.74C295.275,178.071,256.647,226.9,220,226.9z">
            </path>

        </svg>
        <div class="flex items-center justify-between ">
            <i class="text-xl text-gray-400 fab fa-behance"></i>
        </div>
        <div class="mt-5 text-2xl font-medium leading-8 text-gray-900 dark:text-gray-200">
            <?php echo $totalMales; ?>
        </div>
        <div class="text-sm text-gray-700 dark:text-gray-500">Female Residents</div>
    </div>
</div>
<div
    class="col-span-2 p-4 bg-white border border-gray-200 rounded-lg shadow-md lg:col-span-1 dark:border-gray-700 sm:p-6 dark:bg-gray-800">
    <div class="relative ">
        <svg class="absolute text-blue-500 h-14 w-14 bottom-4 right-3" height="200px" width="200px" version="1.1"
            id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 512 512" xml:space="preserve" fill="currentColor">

            <style type="text/css">
            .st0 {
                fill: currentColor;
            }
            </style>

            <path class="st0"
                d="M432.871,404.268c-10.756-18.361-27.411-29.408-43.426-36.782c-16.038-7.367-31.903-11.337-41.438-14.935 c-7.56-2.808-15.799-7.195-21.676-11.948c-2.943-2.346-5.274-4.782-6.674-6.904c-1.446-2.13-1.885-3.784-1.885-4.894 c0-7.591,0-11.025,0-22.57c10.116-11.263,24.655-28.7,30.615-56.358c2.093-0.938,4.156-1.996,6.138-3.389 c4.96-3.412,9.154-8.365,12.708-15.106c3.59-6.771,6.756-15.427,10.138-27.27c1.706-6.011,2.51-11.226,2.51-15.874 c0-5.356-1.103-9.996-3.129-13.772c-1.743-3.293-4.127-5.661-6.592-7.419c32.73-73.058-9.289-131.94-9.289-131.94l12.335-31.709 c0,0-52.849,3.523-99.814-1.758c-135.694-15.247-143.277,79.858-143.277,122.13c0,25.326,3.784,40.045,7.061,48.06 c-0.663,0.871-1.378,1.631-1.929,2.644c-2.018,3.769-3.121,8.417-3.121,13.772c0.015,4.64,0.797,9.855,2.518,15.866 c4.529,15.769,8.611,25.944,13.9,33.422c2.652,3.71,5.654,6.69,8.931,8.954c1.996,1.393,4.06,2.451,6.138,3.389 c5.974,27.642,20.506,45.087,30.622,56.35c0,11.546,0,14.987,0,22.578c0.022,0.946-0.455,2.681-2.026,4.924 c-2.287,3.359-6.771,7.359-11.985,10.741c-5.192,3.404-11.106,6.287-16.074,8.03c-6.458,2.279-15.732,4.819-25.885,8.409 c-15.248,5.401-32.73,13.178-46.726,27.151c-14.018,13.914-23.985,34.316-23.902,62.324c0,3.561,0.156,7.256,0.484,11.062 c0.209,2.391,1.042,4.365,2.048,6.049c1.944,3.136,4.558,5.571,7.844,8.045c5.758,4.268,13.75,8.469,24.141,12.611 c31.062,12.342,83.614,23.836,153.855,23.85c57.073-0.007,102.495-7.612,134.168-17.072c15.836-4.738,28.208-9.908,37.095-15.025 c4.461-2.57,8.052-5.117,10.89-7.888c1.415-1.386,2.652-2.831,3.672-4.522c1.02-1.684,1.855-3.658,2.064-6.041 c0.32-3.814,0.469-7.493,0.469-11.039C444.38,431.754,440.045,416.477,432.871,404.268z M243.374,496.291 c-0.246-0.008-0.492-0.008-0.745-0.008l-24.812-58.228l0.32,0.253l22.57-28.216l3.702,15.575h0.991L243.374,496.291z M212.975,426.704l-28.462-66.756c3.568-2.071,7.076-4.35,10.294-6.905c1.966-1.579,3.844-3.24,5.564-5.006l47.56,34.965 L212.975,426.704z M207.068,338.979c1.572-3.053,2.645-6.435,2.66-10.174c0-8.224,0-11.441,0-25.535v-2.979l-1.982-2.205 c-10.57-11.776-24.879-27.404-29.848-55.173l-0.79-4.447l-4.238-1.505c-2.696-0.96-4.744-1.951-6.548-3.195 c-2.644-1.869-5.05-4.425-7.858-9.653c-2.764-5.2-5.714-12.976-8.916-24.261c-1.423-4.924-1.915-8.76-1.915-11.605 c0-3.314,0.633-5.236,1.282-6.465c0.976-1.774,2.175-2.533,3.702-3.143c1.043-0.403,2.145-0.552,2.778-0.604l6.011,1.274 l8.633,14.92c0,0-0.469-74.205,7.047-79.851c9.393-7.054,63.426,14.093,79.858,14.093c16.446,0,68.7-22.905,77.974-15.97 c10.786,8.067,8.931,88.774,8.931,88.774l8.834-22.86l3.621-0.388c0.633,0.008,2.942,0.276,4.514,1.311 c0.879,0.574,1.609,1.236,2.272,2.443c0.641,1.229,1.274,3.151,1.274,6.458c0.014,2.853-0.492,6.689-1.899,11.62 c-4.276,15.046-8.104,23.806-11.628,28.663c-1.758,2.458-3.367,3.986-5.162,5.244c-1.788,1.244-3.851,2.235-6.548,3.195 l-4.238,1.505l-0.782,4.447c-4.953,27.769-19.27,43.397-29.84,55.173l-1.996,2.205v2.979c0,14.094,0,17.311,0,25.535 c0.015,3.724,1.035,7.143,2.592,10.235l-48.857,35.895L207.068,338.979z M269.341,496.35c-0.246,0.015-0.462,0.022-0.716,0.022 l-2.033-70.704h1.028l3.695-15.575l22.562,28.208l0.32-0.246L269.341,496.35z M299.024,426.704l-34.95-43.694l47.516-34.928 c3.247,3.315,6.994,6.294,11.054,8.968c1.564,1.021,3.248,1.862,4.886,2.793L299.024,426.704z">
            </path>

        </svg>
        <div class="flex items-center justify-between ">
            <i class="text-xl text-gray-400 fab fa-behance"></i>
        </div>
        <div class="mt-5 text-2xl font-medium leading-8 text-gray-900 dark:text-gray-200">
            <?php
echo $totalFemales;
?>
        </div>
        <div class="text-sm text-gray-700 dark:text-gray-500">Male Residents</div>
    </div>
</div>
<div
    class="col-span-2 p-4 bg-white border border-gray-200 rounded-lg shadow-md lg:col-span-1 dark:border-gray-700 sm:p-6 dark:bg-gray-800">
    <div class="relative ">
        <svg class="absolute text-blue-500 h-14 w-14 bottom-4 right-3" viewBox="-96 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
            
                <path fill="currentColor"
                    d="M264,288c-30.928,0 -56,25.072 -56,56l0,38.25c0,8.837 7.163,16 16,16c8.837,0 16,-7.163 16,-16l0,-38.25c0,-13.255 10.745,-24 24,-24c13.255,0 24,10.745 24,24l0,152c0,8.837 7.163,16 16,16c8.837,0 16,-7.163 16,-16l0,-152c0,-30.928 -25.072,-56 -56,-56Zm-133.257,-175.437c12.189,0.75 20.568,6.001 25.139,15.752l44.827,83.406l79.784,9.066c14.116,1.604 24.259,14.347 22.655,28.463c-1.607,14.142 -14.394,24.291 -28.532,22.646l-93.616,-10.896c-4,-0.5 -10.596,-2.633 -15.262,-6.384c-4.666,-3.751 -9.284,-8.392 -13.855,-13.924c-4.571,-5.532 -8.38,-10.455 -11.427,-14.768c-3.047,-4.313 -6.809,-9.939 -11.284,-16.878c-4.476,-6.938 -7.57,-11.626 -9.284,-14.064l-31.424,82.138l11.998,69.76c1.714,7.689 2.571,12.94 2.571,15.753c0,2.813 -0.762,7.782 -2.285,14.909l-25.425,109.423c-4.19,16.69 -17.617,25.035 -40.28,25.035c-9.522,-0.188 -17.188,-4.219 -22.996,-12.096c-5.809,-7.876 -7.856,-16.69 -6.142,-26.441l21.425,-114.206l-17.712,-75.668c-8.379,-18.753 -11.284,-37.881 -8.713,-57.384c2.571,-19.503 9.666,-38.349 21.283,-56.54c24.187,-37.506 51.421,-56.727 81.702,-57.665c13.331,0 22.282,0.188 26.853,0.563Zm109.257,-56.563c0,30.928 -25.072,56 -56,56c-30.928,0 -56,-25.072 -56,-56c0,-30.928 25.072,-56 56,-56c30.928,0 56,25.072 56,56Z">
                </path>

        </svg>
        <div class="flex items-center justify-between ">
            <i class="text-xl text-gray-400 fab fa-behance"></i>
        </div>
        <div class="mt-5 text-2xl font-medium leading-8 text-gray-900 dark:text-gray-200">
            <?php echo $totalSeniors;
?>
        </div>
        <div class="text-sm text-gray-700 dark:text-gray-500">Senior Citizen</div>
    </div>
</div>